---
{"dg-publish":true,"permalink":"/knowledge point/C/编译与连接/","dgPassFrontmatter":true}
---

参考：《跟我一起写makefile》

一般来说，无论是`C`、`C++`、还是`pas`，首先要把源文件编译成中间代码文件，在`Windows`下也就是`.obj`文件，`UNIX`下是`.o`文件，即 `Object File`，这个动作叫做**编译（compile）**。然后再把大量的`Object File`合成执行文件，这个动作叫作**链接（link）**。

编译时，编译器需要的是**语法**的正确，**函数与变量的声明**的正确。对于后者，通常是你需要告诉编译器**头文件的所在位置**（头文件中应该只是声明，而定义应该放在`C/C++`文件中），只要所有的语法正确，编译器就可以编译出中间目标文件。一般来说，**每个源文件都应该对应于一个中间目标文件**（`.o`文件或是`.obj`文件）。

链接时，主要是**链接函数和全局变量**，所以，我们可以使用这些中间目标文件（`.o`文件或是`.obj`文件）来链接我们的应用程序。链接器并不管函数所在的源文件，只管函数的中间目标文件（Object File），在大多数时候，由于源文件太多，编译生成的中间目标文件太多，而在链接时需要明显地指出中间目标文件名，这对于编译很不方便，所以，我们要**给中间目标文件打个包**，在`Windows`下这种包叫**库文件（Library File)**，也就是`.lib` 文件，在`UNIX`下，是**Archive File**，也就是`.a`文件。

总结一下，源文件首先会生成**中间目标文件**，再由中间目标文件生成**执行文件**。在编译时，编译器只检测程序语法，和函数、变量是否被声明。如果函数未被声明，编译器会给出一个警告，但可以生成`Object File`。而在链接程序时，链接器会在所有的`Object File`中找寻函数的实现，如果找不到，那到就会报链接错误码（Linker Error）。