---
{"dg-publish":true,"permalink":"/work diary/RISC-V/Prismä¸­æ–­å’¬å°¾ï¼ˆSDKï¼‰/","dgPassFrontmatter":true}
---

# å‚è€ƒèµ„æ–™ğŸ“š
http://bbs.eeworld.com.cn/thread-1162456-1-1.html ï¼ˆè®ºå›ã€åšå®¢ã€ä¸“æ ï¼‰
https://zhuanlan.zhihu.com/p/588075416 ï¼ˆè®ºå›ã€åšå®¢ã€ä¸“æ ï¼‰
GD32VF103 SDK ï¼ˆæºä»£ç ï¼‰
![Pasted image 20231218115302.png](/img/user/work%20diary/imgs/Pasted%20image%2020231218115302.png)
![Pasted image 20231218115546.png](/img/user/work%20diary/imgs/Pasted%20image%2020231218115546.png)
![Pasted image 20231218115642.png](/img/user/work%20diary/imgs/Pasted%20image%2020231218115642.png)

# Prismä¸ä¸­æ–­ç›¸å…³çš„è½¯ä»¶æµç¨‹åˆ†æ
## å¯åŠ¨ç¨‹åºï¼ˆcrt0.Sï¼‰
1.å…³é—­å…¨å±€ä½¿èƒ½
2.è°ƒç”¨å‡½æ•°--call initï¼ˆåœ¨handler.cï¼‰

## ä¸­æ–­å¤„ç†ï¼ˆhandler.cï¼‰
1.mstatuså†™å…¥0x08,å³æ‰“å¼€å…¨å±€ä½¿èƒ½ï¼›mtvecå†™å…¥trap_entryçš„åœ°å€ï¼Œå³ä¸­æ–­å…¥å£ã€‚
2.å®šä¹‰ä¸€ä¸ªä¸­æ–­å…¬å…±å…¥å£å‡½æ•°ï¼Œåˆ†è¾¨trapç±»å‹ï¼Œè·³å…¥ä¸åŒtrapçš„å¤„ç†å‡½æ•°ã€‚

## entry.S
1.åŒ…å«ä¸Šä¸‹æ–‡å…¥æ ˆ/å‡ºæ ˆä¸¤ä¸ªå‡½æ•°ã€‚
2.å¤„ç†trapï¼Œé¦–å…ˆå…¥æ ˆä¸Šä¸‹æ–‡ï¼Œç„¶åcall trapçš„å…¬å…±å…¥å£ï¼ˆå³handler.cä¸­çš„å‡½æ•°ï¼‰ã€‚

# ä¿®æ”¹SDKä»¥æ”¯æŒä¸­æ–­å’¬å°¾
## crt0.S
1.å…³é—­å…¨å±€ä½¿èƒ½
2.è°ƒç”¨å‡½æ•°--call initï¼ˆåœ¨handler.cï¼‰

## handler.c
1.å°†åŸæ¥çš„trap handlerï¼ˆtrapæŒ‡çš„æ˜¯ç‹­ä¹‰å¼‚å¸¸ä¸ä¸­æ–­ï¼‰ï¼Œæ‹†åˆ†ä¸ºå¼‚å¸¸ handlerå’Œä¸­æ–­handlerã€‚
2.initå‡½æ•°ï¼šå‘mtvecã€mtvtã€mtvt2è¿™ä¸‰ä¸ªcsrå¯„å­˜å™¨ä¸­å†™å…¥å¼‚å¸¸å¤„ç†å…¬å…±å…¥å£ã€ä¸­æ–­å‘é‡è¡¨ã€ä¸­æ–­å¤„ç†å…¬å…±å…¥å£çš„åŸºåœ°å€ã€‚
3.ä¸­æ–­å‘é‡è¡¨ï¼šä¸€ä¸ªç”±jalæŒ‡ä»¤æ„æˆçš„æŒ‡ä»¤å—å„¿ï¼Œæ¯ä¸€æ¡jalæŒ‡ä»¤å¯¹åº”ä¸€ä¸ªä¸­æ–­ï¼Œè·³å‘è¯¥ä¸­æ–­å¯¹åº”çš„ISRã€‚

## entry.S
1.ä¸Šä¸‹æ–‡å…¥æ ˆ/å‡ºæ ˆå‡½æ•°ï¼Œæ²¡æœ‰ä¿®æ”¹ã€‚
2.å¼‚å¸¸handlerï¼šæ²¡æœ‰ä¿®æ”¹ï¼Œæ³¨æ„callå¼‚å¸¸çš„å…¬å…±å…¥å£å³å¯ã€‚
3.ä¸­æ–­handlerï¼šå…¥æ ˆã€ç‰¹æ®ŠæŒ‡ä»¤ã€å‡ºæ ˆã€‚

## main.c
1.ä¸­æ–­åˆå§‹åŒ–ï¼šä½¿èƒ½å„ä¸­æ–­å¹¶è®¾å®šä¼˜å…ˆçº§ã€è®¾å®šä¼˜å…ˆçº§é˜ˆå€¼ã€‚
2.ç¼–å†™ä¸­æ–­æœåŠ¡å‡½æ•°ï¼Œå‡½æ•°åç§°è¦å’Œå‘é‡è¡¨ä¸­çš„åç§°ä¸€è‡´ã€‚

## å¯ç”¨ä¸­æ–­å’¬å°¾

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨å¼€å¯ä¸­æ–­ä½¿èƒ½ä¹‹åå‘mtvt2å¯„å­˜å™¨çš„æœ€ä½ä½å†™å…¥1ï¼Œå³å¯å¼€å¯ä¸­æ–­å’¬å°¾åŠŸèƒ½ã€‚
![Pasted image 20240106131603.png](/img/user/work%20diary/imgs/Pasted%20image%2020240106131603.png)
ç¼–å†™å¯¹åº”ä¸­æ–­æœåŠ¡å‡½æ•°æ—¶åªéœ€è¦æ³¨æ„å‡½æ•°åå³å¯ï¼Œé¡»å‘½åä¸ºhandle_m_ext_interrupt_1/ handle_m_ext_interrupt_2/ handle_m_ext_interrupt_3/ handle_m_ext_interrupt_4ï¼Œä¸ç›®å‰å¯ç”¨çš„å››ä¸ªä¸­æ–­å¯¹åº”ã€‚