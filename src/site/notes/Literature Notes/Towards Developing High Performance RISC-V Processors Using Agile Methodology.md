---
{"dg-publish":true,"permalink":"/Literature Notes/Towards Developing High Performance RISC-V Processors Using Agile Methodology/","dgPassFrontmatter":true}
---

## 作者
中国科学院计算技术研究所
## 摘要
虽然研究表明敏捷芯片设计方法有望以更有效的方式维持计算性能的扩展，但由于两个主要障碍，它在实际应用中的使用仍然有限：1）缺乏工具链和开发框架支持敏捷芯片设计，特别是大规模现代处理器。 2）传统的验证方法敏捷性较差，成为整个流程的主要瓶颈。为了解决这两个问题，我们提出了 MINJIE，一个支持敏捷处理器开发流程的开源平台。 Minjie集成了一套逻辑设计，功能验证，性能建模，塞利康前验证和调试的广泛工具，以提高最先进的处理器设计的开发效率。
我们通过使用敏捷方法来构建两代开源超级级别的RISC-V处理器代码为Xiangshan的开源超级量表，以证明Minjie的使用和有效性。我们使用Spec CPU2006基准测试了Xiangshan的性能，并证明了Xiangshan实现了行业竞争性的绩效。
## 本文的意义
敏捷芯片设计方法可能减少芯片开发成本和设计周期。
但是存在两个问题，首先是目前尚不清楚这种方式是否适合应用于现代处理器等大规模设计，其次是在大规模的芯片设计中，验证是一个主要的瓶颈，然而这种设计方式主要关注快速原型设计而非验证。
为了解决这两个问题，提出了MINJIE平台，其中包含丰富的敏捷开发工具以及基于Diff-Rule的敏捷验证机制，并通过这套平台在十个月内设计了第一代香山处理器。

## MINJIE解决哪些问题
### 处理器功能验证——协同仿真环境中的不确定性问题
处理器验证的常见做法是构建一个联合仿真框架来比较待测设计 (DUT) 和参考模型 (REF) 的结果之间的等效性。结果可以配置根据验证目标具有不同的内容。例如，为了确保 ISA 级合规性，结果被定义为处理器的体系结构状态，例如通用寄存器和程序计数器。然而，这种严格的等效性测试策略必须解决受设计的微架构实现细节影响的非确定性行为问题，例如，不精确的异常和异步中断可能会不可预测地破坏处理器的正常指令流。对于没有微架构信息的参考模型，存在更多的非确定性场景，这些事件通常会导致 DUT 和 REF 的结果出现分歧。这也是形式验证和软件测试中广泛接受的挑战，需要维护和探索大量的状态空间，本文演示了如何解决协同仿真环境中的不确定性问题。

### 验证框架——敏捷设计过程中的不匹配问题
在传统的验证方式是给定相同的设计规范，RTL工程师用Verilog构建处理器，而验证工程师则用其他语言（例如SystemVerilog、C/C++）为处理器的各个部分和级别开发相应的参考模型。 Verilog 设计 (DUT) 和 REF 被放入 UVM 等验证框架中，以检查其结果之间的等效性。
然而敏捷设计涉及频繁生成更新设计实例的高级HDL，这种新的设计范式给参考模型及与DUT的交互带来两个挑战。首先REF需要涵盖REF不同迭代中不同微架构的相关细节，并避免其结果之间的不匹配。其次，高层 HDL 的微小修改可能会导致 Verilog 的重大变化，并严重破坏原始验证代码。因此，验证工程师深受敏捷开发之苦，本文解决了这两个问题。

### RTL设计的仿真与Debug——软件RTL模拟器的效率问题
硬件设计需要长时间的RTL仿真来完成验证过程，常见方法包括基于软件、FPGA 和仿真器的 RTL 仿真。FPGA运行速度最快，很多工作已经解决了可扩展性、可调试性和长综合时间的问题，但仍需针对大规模设计进行改进。Cadence Palladium、Mentor Veloce  和 Synopsys Zebu等仿真器可以以 MHz 的速度仿真大型电路，具有完全可视性和良好的可调试性，但他们非常昂贵，学术界和工业界都难以大规模部署。
基于软件的 RTL 模拟器是最常用的工具，可提供模拟电路的完整可见性。然而，对于大规模设计，软件方法的运行速度为 KHz，当启用必要的调试信息（例如波形和日志）时，软件方法会变得更慢。解决基于软件的 RTL 仿真器的调试效率具有重要意义，因为它们几乎用于所有硬件项目。本文演示了加快调试过程的方法。

### 性能评估
准确的投片前性能评估和验证对于高性能处理器非常重要。使用敏捷方法评估处理器设计也至关重要，因为它会影响功能探索的效率。本文演示了基于软件RTL仿真的性能评估工作流程。

## MINJIE平台的详细介绍——如何解决上述问题
### 高效处理器验证方法
论文创新性地提出了基于规则（Diff-Rule）完成对设计行为非确定性的刻画，有效降低参考模型与验证框架的开发与维护成本，提高硬件验证效率。论文进一步发现并明确了 RISC-V 处理器与典型多层 Cache 结构中的非确定性行为来源，实现了针对通用 RISC-V 处理器的协同仿真验证框架 DiffTest，已成功地应用于香山、一生一芯等项目的开发过程中。

### LightSSS
软件 RTL 仿真是硬件验证与调试的常用手段，出错时的错误现场复现则是调试时最耗时的一步。论文提出了一种轻量级仿真快照技术 LightSSS，利用操作系统提供的 fork 接口完成对仿真进程的定期快照，并在仿真出错时恢复上一个快照进行调试。实验评估结果显示，LightSSS 相比当前业界最优的仿真快照方案 LiveSim 有显著优势，成功地将仿真快照开销从 10% ~ 20% 降低至 0.01%，大幅度地提高了硬件开发时的调试效率。

![Pasted image 20240314202815.png](/img/user/Literature%20Notes/imgs/Pasted%20image%2020240314202815.png)